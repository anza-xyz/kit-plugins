# Agent Instructions

You are contributing to **Kit Plugins** (`@solana/kit-plugins`), a plugin library for [Solana Kit](https://github.com/anza-xyz/kit). Read [`CONTRIBUTING.md`](./CONTRIBUTING.md) for full project context including the monorepo structure, available scripts, and code standards.

## Code quality checklist

For every change you make, verify the following before presenting the changes to the user:

- **Docblocks**: All exported symbols (functions, types, interfaces, constants) must have JSDoc docblocks. Use the `ts-docblocks` skill for the full style guide.
- **Tests**: New features and bug fixes need tests. Tests use Vitest and run in three environments (Node.js, browser, React Native). Run `pnpm test:unit` in the relevant package directory to verify.
- **README**: When adding a new public API, add a section to the package's `README.md` following the existing structure. When modifying an existing API, keep the README in sync.
- **Umbrella package**: The umbrella package (`packages/kit-plugins`) re-exports all `kit-plugin-*` packages via `export *`. Client factory functions from `kit-client-*` packages are re-exported in `defaults.ts` with `@deprecated` tags. New client factories should live in their own `kit-client-*` package, not in the umbrella.
- **Guidelines**: When adding new packages, renaming public APIs, or changing the monorepo structure, check whether `CLAUDE.md` and `CONTRIBUTING.md` need updates to stay in sync (e.g. package tables, workflow descriptions, naming conventions).

## Git workflow

Check if the user has [Graphite](https://graphite.dev/) installed (`which gt`). Prefer Graphite when available; fall back to standard Git otherwise. See the shipping skills for detailed workflows.

## Available skills

This project includes the following skills in `.claude/skills/`. Use them when relevant:

| Skill               | Description                                              |
| ------------------- | -------------------------------------------------------- |
| `changesets`        | Generate a changeset file with a proper changelog entry. |
| `shipping-git`      | Shipping workflow using standard Git.                    |
| `shipping-graphite` | Shipping workflow using Graphite CLI.                    |
| `ts-docblocks`      | Add missing docblocks to exported symbols.               |
| `ts-readme`         | Create or update a README file.                          |

## CI expectations

Before presenting changes for review, verify locally:

- `pnpm lint` passes (ESLint + Prettier).
- `pnpm test` passes (type checking + unit tests across all environments).
- `pnpm build` succeeds and does not produce uncommitted changes in the working tree.

Running these in the relevant package directory (e.g. `pnpm test:unit` in `packages/kit-plugin-payer`) is sufficient for focused changes.

<!-- skills-inject:start -->

## Skill Instructions

The following instructions come from installed skills (autogenerated, do not edit manually) and should always be followed.

### Changesets

- Any PR that should trigger a package release MUST include a changeset.
- Identify affected packages by mapping changed files to their nearest `package.json`.
- Choose the right bump: `patch` for fixes, `minor` for features, `major` for breaking changes.
- While a project is pre-1.0, `minor` bumps may be treated as breaking.
- ALWAYS use `npx changeset add --empty` to generate a new changeset file with a random name. NEVER create changeset files manually.
- No changeset needed for: docs-only changes, CI config, dev dependency updates, test-only changes.

### Shipping (Git)

- NEVER commit, push, create branches, or create PRs without explicit user approval.
- Before any git operation that creates or modifies a commit, present a review block containing: changeset content (if applicable), commit title, and commit/PR description. ALWAYS wait for approval.
- Use standard `git add` and `git commit` workflows. Concise title on the first line, blank line, then description body.
- Use `gh pr create` for pull requests.

### Shipping (Graphite)

- NEVER commit, push, create branches, or create PRs without explicit user approval.
- Before any git operation that creates or modifies a commit, present a review block containing: changeset content (if applicable), commit title, and commit/PR description. ALWAYS wait for approval.
- Use `gt create -am "Title" -m "Description body"` for new PRs. The first `-m` sets the commit title; the second sets the PR description.
- Use `gt modify -a` to amend the current branch with follow-up changes (NEVER create additional commits on the same branch).
- ALWAYS escape backticks in commit messages with backslashes for shell compatibility (e.g. `"Update \`my-package\` config"`).

### TypeScript Docblocks

- All exported functions, types, interfaces, and constants MUST have JSDoc docblocks.
- Start with `/**`, use `*` prefix for each line, end with `*/` â€” each on its own line.
- Begin with a clear one-to-two line summary. Add a blank line before tags.
- Include `@param`, `@typeParam`, `@return`, `@throws`, and at least one `@example` when helpful.
- Use `{@link ...}` to reference related items. Add `@see` tags at the end for related APIs.

### TypeScript READMEs

- When adding a new public API, add or update the package's README.
- Structure: brief intro, installation, usage (with code snippet), deep-dive sections.
- Code snippets must be realistic, concise, and use TypeScript syntax.
- Focus on the quickest path to success. Developers should feel excited, not overwhelmed.

<!-- skills-inject:end -->
